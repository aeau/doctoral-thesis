\subsection{Experiment Setup}

\input{included-papers-tex/paper-11/tables/table0}
\input{included-papers-tex/paper-11/tables/table2}
\input{included-papers-tex/paper-11/tables/table3}


%\begin{itemize}
%    \item Describe what graphs were used, dimensions, the values for mutation, crossover, recipe amounts, iterations, etc.
%\end{itemize}

We ran a set of experiments using different narrative graphs as starting points and level constraints to evaluate Story Designer, the use of TropeTwist with IC MAP-Elites, and its adaptability. Our goal is to analyze how IC MAP-Elites can adapt to the designer's narrative graph and how that affects the search space. At the same time, we explore how we can connect level and narrative and the effect using level design constraints have on the development and generation of narrative structures.

We ran each experiment $5$ times, set the initial population to $1000$ randomly created grammars, and each individual is limited to test $5$ recipes regardless of the chromosome size. Offspring were produced either by selecting either the left-side or right-side of a random production rule and exchanging them or with a $50$\% mutation chance. If an offspring was generated by mutation, there was a $10$\% chance to add or remove a production rule and a $90$\% to modify existing production rules in various ways (e.g., removing, adding, or changing part the rule). When using level constraints, these were enforced as feasibility constraints, effectively setting individuals as infeasible if violating any constraint.

For each experiment, we used the dimension pairs \textbf{Interestingness}\textbf{-Step} and all dimensions for IC MAP-Elites to compare different space constraints that would be employed in an MI-CC system and a full space search across dimensions similar to Alvarez et al.'s work~\citepeleventh{p11alvarez_interactive_2020}. Experiments 1-3 consist of reusing the three proof-of-concept narrative graphs used by Alvarez and Font~\citepeleventh{p11alvarez_tropetwist_2022}, and testing them in Story Designer; assessing the impact of level constraints and how the space is explored in comparison with previous results. Experiment 4 assesses the same as experiments 1-3 but focuses on evaluating the system's adaptability and how IC MAP-Elites respond to design changes, which enables different patterns to arise in the narrative structure. Experiment 4 is evaluated as a whole and step by step in the design process (5 core steps). For experiments 1-3, we ran each for $500$ generations when using a pair of dimensions and for $250$ when using all dimensions. For experiment 4, each step in the design is done after $50$ generations; thus, we recorded data every $50$ generations.


%Odd columns are with level constraints and even without constraints.

\subsubsection{Metrics}

All our experiments are evaluated and analyzed following the same procedure and metrics, focusing on the novel generated individuals and their average across the $5$ runs. In particular, we focus on the \textit{average coverage}, \textit{average unique individuals}, \textit{average fitness}, and \textit{average interestingness}. \textit{Average coverage} is the cumulative coverage of the search space after a set of generations focused on the Step-Interestingness dimension pair. \textit{Average uniques} is a simple count of how many novel individuals were created throughout the experiments. \textit{Average fitness} calculates the average individual fitness in the search throughout all generations. Finally, \textit{average interestingness} calculates the average individual interestingness in the search throughout all generations.



\subsubsection{Narrative Graphs for Experiments}

Figure~\ref{fig:examples} and table~\ref{tab:level-constraints} show the target narrative graphs used in each experiment and their level design constraints, respectively. Experiments 1-3 use the proof-of-concept narrative graphs presented by Alvarez and Font~\citepeleventh{p11alvarez_tropetwist_2022} and experiment 4 uses a handmade narrative graph, exemplar of what a designer could create in Story Designer. 

Experiment 1 represents the overarching narrative structure of Super Mario Bros. (SMB)~\citepeleventh{p11nintendo_rd1_super_1985}. Mario (HERO) has as objective to rescue Princess Peach (HERO) from Bowser (BAD), who keeps Peach as a prisoner until Mario beats it, creating a derivative and conditional relation between Bowser and Peach. Before reaching Bowser, Mario must face "fake Bowsers" (DRA). Experiment 2 represents the structure from the eastern palace in \emph{Zelda: A Link to the Past} (Zelda:LttP)~\citepeleventh{p11nintendo_rd4_legend_1991}. Link (HERO) has as a goal the "Pendant of Courage" (MCG), but in order to collect it, Link must face ENEMY and BAD since there is a derivative pattern connecting them to (MCG). All palaces in \textit{A Link to the Past} follow a very similar structure and sequence. Experiment 3 represents a simplified overarching structure from \emph{Zelda: Ocarina of Time} (Zelda:OoT)~\citepeleventh{p11nintendo_rd4_legend_1998}. Young Link (HERO) has as a goal to collect/receive the Ocarina of Time (MCG), which enables the appearance of Adult Link (NEO). Achieving this goal creates conflicts between several heroes, Link and Zelda - Sheik (NEO, SH), and Gannondorf (BAD). 

Experiment 4 was designed with the capabilities of Story Designer in mind; step by step as a designer would create the narrative structure. First, it starts with the default structure; a HERO has a CONFLICT with an ENEMY. Subsequently, the structure is changed to fine-tune the ENEMY to BAD and create a goal (MCG) for the HERO. Another enemy (DRA) is added, creating a side conflict for the HERO (i.e., BAD is by definition the ``final boss"). Finally, the DRA is connected with the MCG with an entail connection, effectively making the DRA part of the game's main loop.

%For instance, the DRA as a side conflict in the game, and then incorporated as a main part of the game since to get the MCG, the HERO needs to face the DRA. 

%This would then in practice be visually different in a level

%Figure~\ref{fig:teaserfig}.a represents a simplified overarching narrative structure from Zelda: OoT. The tri-force, which is the main item to collect in the game, is defined as a McGuffin (MCG) that, when collected by "young link," allows him to go forward in time to "adult link," the chosen one (NEO). This, in turn, enables explicit conflicts between hero and enemy characters, which represents the main loop of the game. The structure shows two factions, a set of heroes and the BAD opposing them. Pattern-wise, $HERO \rightarrow SH$ represents an \textbf{RevP}, which in turn, represents an \textbf{PT}; $HERO \leftarrow MCG \leftarrow NEO$ represents an \textbf{APD}, and the rest of elements are interconnected by \textbf{ConfP}.

%Figure~\ref{fig:teaserfig}.b represents the structure and plot points from the eastern palace in Zelda: LttP. All palaces in \textit{A Link to the Past} follow a very similar structure and sequence. The HERO's goal is to get the "Pendant of Courage" (MCG). However, the MCG derives from ENEMY and BAD, so the HERO must overcome them to achieve his goal. The structure shows a causal and linear narrative that could be used to identify elements that need to appear before others, similar to the work by Dormans and Bakkes~\citepeleventh{p11dormans2011generating}. Pattern-wise, ENEMY $\diamondsuit$-- MHQ $\diamondsuit$-- BAD $\diamondsuit$-- MCG represent an \textbf{DerP}, and ENEMY $\diamondsuit$--- MHQ $\diamondsuit$-- BAD, BAD $\diamondsuit$-- MCG $\rightarrow$ HERO, and HERO $\diamondsuit$-- MHQ $\rightarrow$ HERO represent \textbf{APDs}.

%Figure~\ref{fig:teaserfig}.c represents the overarching narrative structure of SMB. In SMB, the objective of Mario (HERO) is to rescue Peach (HERO) from Bowser (BAD). To do this, the player goes through a series of platform worlds that always end in a "Fake Bowser" (DRA). The player must continue until encountering the "Real Bowser" (BAD), which then would enable the player to get to their objective (MCG). Pattern-wise, the game represents a simple narrative structure, where EMP $\diamondsuit$-- DRA $\diamondsuit$-- BAD $\diamondsuit$-- MCG, denotes an \textbf{DerP} as a linear increase in difficulty, and HERO $\rightarrow$ MCG $\rightarrow$ HERO denotes an \textbf{APD}.

%as that is defined as a new step in the design. 

%We ran each experiment $5$ times, set the initial population to $100$ randomly created grammars, and each individual is limited to test $10$ recipes regardless of the chromosome size. ran each experiment run for $500$ generations when using a pair of dimensions and for $250$ when using all dimensions since using all dimensions is more computational expensive. Each individual is limited to test $10$ recipes regardless of the chromosome size. Offspring were produced either by selecting either the left-side or right-side of a random production rule and exchanging them or with a $50$\% mutation chance. If an offspring was generated by mutation, there was a $10$\% chance to add or remove a production rule and a $90$\% to modify in various ways existing production rules. When using level constraints, these were enforced as feasibility constraints, effectively setting individuals as infeasible if violating any constraint.

%For all experiments we ran $5$ MAP-Elites runs per experiment, ran each for $500$ generations, and set the initial population to $100$ randomly created individuals. 

%The target narrative graphs used in each experiment along with their level design constraints can be seen in figure~\ref{fig:experiment-narrative-graphs}. For each experiment, we used the dimension pairs \textbf{Interestingness-Step} and all dimensions for IC MAP-Elites to compare different space constraints that would be employed in a MI-CC system and a full space search across dimensions similar to Alvarez et al.'s work~\citepeleventh{p11alvarez_interactive_2020}. Furthermore, we calculated the \textit{coverage}: how much of the constrained search space is explored (i.e., constrained by the behavioral dimensions); the avg. fitness and the avg. interestingness of the population. 

%TropeTwist can be used to represent different narrative structures and parts of games. To test and show TropeTwist's expressiveness, we chose to form three different narrative graphs representing different games shown in figure~\ref{fig:teaserfig}, top row: \emph{Zelda: Ocarina of Time} (Zelda:OoT)~\citepeleventh{p11tloz:oot}, \emph{Zelda: A Link to the Past} (Zelda:LttP)~\citepeleventh{p11tloz:lttp} - eastern palace, and \emph{Super Mario Bros} (SMB)~\citepeleventh{p11mario}. They represent different games from different genres (fig.~\ref{fig:teaserfig}.a and \ref{fig:teaserfig}.b are adventure-dungeon games, and \ref{fig:teaserfig}.c is a platform), and represent different game's phases; in the case of fig.~\ref{fig:teaserfig}.a and \ref{fig:teaserfig}.c, both represent the main structure of the game, while \ref{fig:teaserfig}.b, represents a specific area and sequence of the game.

%Figure~\ref{fig:teaserfig}.a represents a simplified overarching narrative structure from Zelda: OoT. The tri-force, which is the main item to collect in the game, is defined as a McGuffin (MCG) that, when collected by "young link," allows him to go forward in time to "adult link," the chosen one (NEO). This, in turn, enables explicit conflicts between hero and enemy characters, which represents the main loop of the game. The structure shows two factions, a set of heroes and the BAD opposing them. Pattern-wise, $HERO \rightarrow SH$ represents an \textbf{RevP}, which in turn, represents an \textbf{PT}; $HERO \leftarrow MCG \leftarrow NEO$ represents an \textbf{APD}, and the rest of elements are interconnected by \textbf{ConfP}.

%Figure~\ref{fig:teaserfig}.b represents the structure and plot points from the eastern palace in Zelda: LttP. All palaces in \textit{A Link to the Past} follow a very similar structure and sequence. The HERO's goal is to get the "Pendant of Courage" (MCG). However, the MCG derives from ENEMY and BAD, so the HERO must overcome them to achieve his goal. The structure shows a causal and linear narrative that could be used to identify elements that need to appear before others, similar to the work by Dormans and Bakkes~\citepeleventh{p11dormans2011generating}. Pattern-wise, ENEMY $\diamondsuit$-- MHQ $\diamondsuit$-- BAD $\diamondsuit$-- MCG represent an \textbf{DerP}, and ENEMY $\diamondsuit$--- MHQ $\diamondsuit$-- BAD, BAD $\diamondsuit$-- MCG $\rightarrow$ HERO, and HERO $\diamondsuit$-- MHQ $\rightarrow$ HERO represent \textbf{APDs}.

%Figure~\ref{fig:teaserfig}.c represents the overarching narrative structure of SMB. In SMB, the objective of Mario (HERO) is to rescue Peach (HERO) from Bowser (BAD). To do this, the player goes through a series of platform worlds that always end in a "Fake Bowser" (DRA). The player must continue until encountering the "Real Bowser" (BAD), which then would enable the player to get to their objective (MCG). Pattern-wise, the game represents a simple narrative structure, where EMP $\diamondsuit$-- DRA $\diamondsuit$-- BAD $\diamondsuit$-- MCG, denotes an \textbf{DerP} as a linear increase in difficulty, and HERO $\rightarrow$ MCG $\rightarrow$ HERO denotes an \textbf{APD}.


% and \textbf{Interestingness-Diversity}

%All runs, regardless of the TG, performed similarly with an avg. of 21\% coverage, 0.68 avg. fitness, and 0.38 avg. interestingness. These results exemplify both the hard task of generating narrative graphs and exploring the possibility space, and the seemingly competing qualities of coherence (i.e., fitness) and interestingness. 

%First, we ran a set of experiments to test the results from the IC MAP-Elites using all possible combinations of the available dimensions using two dimensions at a time. All experiments were run using $13\times7$ rooms, the same room size as in \emph{The Binding of Isaac}~\citepeleventh{p11mcmillen_emphthe_2011}, a representative example of a dungeon-based adventure game. In each experiment, the initial population was set to $1000$ mutated individuals distributed in feasible and infeasible populations in all cells which were set to a maximum capacity of $25$ individuals each. IC MAP-Elites ran continuously, and every $100$ generations rendered the elites of each cell. At each generation, it selected $5$ parents per population among uniformly random chosen cells. Offspring were always produced through a two-point crossover and had a 30\% chance of being mutated, which would randomly alter one tile in the level.ov

%We have conducted a series of experiments on EDD with the aims of analyzing the \emph{adaptability} and \emph{stability} of IC MAP-Elites, as well as the effects and consequences of the interaction for MAP-Elites and the user. \emph{Stability} relates to the steady generation ovof high-performing individuals, while gradually growing the search and stably generating throughout the generative space at each step. \emph{Adaptability} relates to the ability of the search to adapt to changing conditions, adjusting the search to the new goals, while still generating high-performing individuals. Both features, relate to the notions of evolvability~\citepeleventh{p11}, the ability of the search to generate creative individuals in problems with changing conditions.

% as how the search process benefits from the continuous mixed-initiative approach. 

%Prior to conducting the experiments, we have recorded four different design sessions, called scenarios, where we manually designed, step by step, four dungeon rooms with specific target design goals (Figure~\ref{figs:roomsexperiments}): a) high leniency, b) low leniency, c) high linearity, and d) high meso-pattern level. 

%The experiments consist on running these pre-recorded scenarios separately on EDD, step by step with a lapse of $100$ evolutionary generations between steps. Each scenario was run under every combination of EDD's feature-dimensions in pairs ($21$), where the dimensions are: leniency (len), linearity (lin), spatial patterns (spa), meso-patterns (meso), symmetry (sym), similarity (sim), and inner similarity (IS). This way, every $100$ generations we gather population data to later analyze how the search and the fitness landscape vary after each design step. Step after step, we measure how the explored generative space grows, as well as how distribution and concentration of elites together with the manually edited room traverse the generative space, while keeping track of all individuals' fitness scores. 

%In all the experiments, the initial population was set to $1000$ mutated individuals distributed in feasible and infeasible populations. All cells were set to a maximum capacity of $25$ individuals each. In every generation, we selected $5$ cells random, and $5$ parents per cell through tournament selection. The random selection followed a uniform distribution. Offspring were produced through a two-point crossover and a $30$\% mutation chance. Using this setup, between $150$ to $2001$ individuals were produced every $100$ generations, with an average of $373$ unique individuals generated every $100$ generations throughout all runs.